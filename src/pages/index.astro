---
import { getCollection } from 'astro:content';
import BaseLayout from '../layouts/BaseLayout.astro';
import Navigation from '../components/Navigation.astro';
import Hero from '../components/Hero.astro';
import WhatWeDo from '../components/WhatWeDo.astro';
import Programs from '../components/Programs.astro';
import Impact from '../components/Impact.astro';
import Process from '../components/Process.astro';
import Contact from '../components/Contact.astro';
import BlogCard from '../components/BlogCard.astro';
import Footer from '../components/Footer.astro';
import '../styles/global.css';

// Get 3 most recent non-draft blog posts
const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);
---

<BaseLayout>
  <Navigation />
  <main>
    <Hero />
    <WhatWeDo />
    <Programs />
    <Impact />
    <Process />
    
    <!-- Blog Section -->
    {recentPosts.length > 0 && (
      <section id="blog" class="py-16 sm:py-20 bg-white">
        <div class="max-w-[1680px] mx-auto px-4 sm:px-6 lg:px-8 xl:px-12">
          <div class="text-center mb-12">
            <span class="text-[#FAC140] font-bold text-base tracking-wide">Blog</span>
            <h2 class="text-3xl sm:text-4xl font-black mt-2 mb-4 text-gray-900">
              Derniers articles et <span class="text-[#4AC6C2]">aperçus</span>
            </h2>
            <p class="text-xl text-gray-600 max-w-3xl mx-auto">
              Découvrez nos conseils pratiques et stratégies éprouvées pour accélérer votre croissance
            </p>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-12 max-w-7xl mx-auto">
            {recentPosts.map((post) => (
              <BlogCard
                title={post.data.title}
                description={post.data.description}
                pubDate={post.data.pubDate}
                slug={post.slug}
                coverImage={post.data.coverImage}
                coverAlt={post.data.coverAlt}
                tags={post.data.tags}
              />
            ))}
          </div>
          
          <div class="text-center">
            <a 
              href="/blog" 
              class="text-[#FAC140] font-['Inter'] font-semibold text-xl hover:text-[#e5a930] transition-colors inline-block"
            >
              Voir tous les articles →
            </a>
          </div>
        </div>
      </section>
    )}
    
    <Contact />
  </main>
  
  <Footer />
</BaseLayout>
