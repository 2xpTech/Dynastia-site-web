---
const testimonials = [
  {
    title: "Rapports scientifiques exceptionnels",
    quote: "Vos redoutables rapports scientifiques RS&DE.",
    author: "JRA",
    avatar: "JR"
  },
  {
    title: "Compréhension et rapport complet",
    quote: "On s'attend à pouvoir livrer le minimum d'information et être en mesure d'obtenir un rapport +/- 95% complet. Nous étions en mesure d'obtenir cela quand tu les faisais mais pas avec X.",
    author: "SB",
    avatar: "SB"
  },
  {
    title: "Crédits doublés",
    quote: "C'est beaucoup plus de crédits que ton prédécesseur. Il nous avait dit que cette partie n'est pas admissible.",
    author: "NC",
    avatar: "NC"
  },
  {
    title: "Un service impeccable avec talent",
    quote: "Tu nous as toujours bien servi et tu as un bon historique. Je reconnais ton talent.",
    author: "JSV",
    avatar: "JS"
  },
  {
    title: "Résultats doublés",
    quote: "Si vous parvenez à doubler cette réclamation RS&DE, je n'hésiterai pas à vous référer à encore plus de clients. Et c'est exactement ce que vous avez fait!",
    author: "JD",
    avatar: "JD"
  },
  {
    title: "Efficacité et vitesse",
    quote: "J'aurais jamais cru que tu pourrais travailler aussi vite, dès le début. Tu es le KING du RS&DE.",
    author: "LM",
    avatar: "LM"
  }
];

const stats = [
  { 
    value: "150+", 
    label: "Clients accompagnés", 
    icon: `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"></path>
    </svg>` 
  },
  { 
    value: "50M$+", 
    label: "Financement obtenu", 
    icon: `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"></path>
    </svg>` 
  },
  { 
    value: "5X", 
    label: "Croissance accélérée", 
    icon: `<svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
    </svg>` 
  }
];
---

<script>
  // Scroll-based testimonial movement for all devices
  const testimonialTrack = document.querySelector('.testimonial-track') as HTMLElement;
  
  if (testimonialTrack) {
    let isScrolling = false;
    
    function updateTestimonialPosition() {
      if (!isScrolling) {
        isScrolling = true;
        requestAnimationFrame(() => {
          const scrollY = window.scrollY;
          const maxScroll = document.body.scrollHeight - window.innerHeight;
          const scrollProgress = scrollY / maxScroll;
          
          // Calculate horizontal translation based on scroll progress
          // Move testimonials left as user scrolls down
          const maxTranslate = testimonialTrack.scrollWidth - window.innerWidth;
          const translateX = -scrollProgress * maxTranslate * 0.3; // 0.3 for smoother movement
          
          testimonialTrack.style.transform = `translateX(${translateX}px)`;
          isScrolling = false;
        });
      }
    }
    
    window.addEventListener('scroll', updateTestimonialPosition);
    window.addEventListener('resize', updateTestimonialPosition);
    
    // Initial position
    updateTestimonialPosition();
    
    // Enable touch scrolling on mobile as backup
    if (window.innerWidth < 640) {
      testimonialTrack.style.scrollSnapType = 'x mandatory';
      testimonialTrack.querySelectorAll('.flex-shrink-0').forEach(card => {
        (card as HTMLElement).style.scrollSnapAlign = 'start';
      });
    }
  }
</script>

<section id="impact" class="py-24 px-4 sm:px-6 lg:px-8 bg-white">
  <div class="max-w-7xl mx-auto">
    <div class="text-center mb-20">
      <h2 class="text-3xl sm:text-4xl font-black text-gray-900">
        Résultats d'entreprises accompagnées
      </h2>
    </div>
    
    <div class="grid grid-cols-3 gap-4 sm:gap-8 mb-20">
      {stats.map((stat) => (
        <div class="text-center">
          <div class="text-2xl sm:text-3xl font-black text-gray-900 font-heading mb-1">{stat.value}</div>
          <div class="text-[10px] sm:text-base text-gray-600 leading-tight">{stat.label}</div>
        </div>
      ))}
    </div>
    
    {/* Testimonial Carousel - Mobile Optimized */}
    <div class="relative overflow-hidden -mx-4 mt-12">
      {/* Fade edges - smaller on mobile */}
      <div class="absolute left-0 top-0 bottom-0 w-4 sm:w-24 bg-gradient-to-r from-white to-transparent z-10 pointer-events-none"></div>
      <div class="absolute right-0 top-0 bottom-0 w-4 sm:w-24 bg-gradient-to-l from-white to-transparent z-10 pointer-events-none"></div>
      
      {/* Testimonial container with horizontal scroll on mobile */}
      <div class="py-6 sm:py-8">
        <div class="testimonial-track flex gap-3 sm:gap-6 px-3 sm:px-8 pb-2 overflow-x-auto sm:overflow-visible scrollbar-hide">
          {/* Show testimonials once on mobile, duplicate on desktop for scroll effect */}
          {testimonials.map((testimonial) => (
            <div 
              class="flex-shrink-0 w-[38vw] sm:w-80 bg-gray-50 rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100"
            >
              <div class="flex flex-col h-full p-3 sm:p-6">
                <div class="flex items-start gap-1 sm:gap-3 mb-2 sm:mb-3">
                  <svg class="w-4 h-4 sm:w-6 sm:h-6 text-[#FAC140]/40 flex-shrink-0 mt-0.5 hidden sm:block" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                  </svg>
                  <h4 class="font-bold text-gray-900 text-xs sm:text-base flex-1 line-clamp-2">{testimonial.title}</h4>
                </div>
                <p class="text-gray-600 text-[10px] sm:text-sm italic leading-relaxed mb-2 sm:mb-4 flex-1 line-clamp-4 sm:line-clamp-none">
                  {testimonial.quote}
                </p>
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1 sm:gap-0">
                  <span class="text-[10px] sm:text-sm font-semibold text-[#FAC140]">— {testimonial.author}</span>
                  <div class="flex gap-0.5">
                    {[...Array(5)].map(() => (
                      <svg class="w-2.5 h-2.5 sm:w-4 sm:h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                      </svg>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          ))}
          {/* Duplicate for desktop continuous scroll */}
          <div class="hidden sm:flex gap-6">
            {testimonials.map((testimonial) => (
              <div 
                class="flex-shrink-0 w-80 bg-gray-50 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 border border-gray-100"
              >
                <div class="flex flex-col h-full p-6">
                  <div class="flex items-start gap-3 mb-3">
                    <svg class="w-6 h-6 text-[#FAC140]/40 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                    </svg>
                    <h4 class="font-bold text-gray-900 text-base flex-1">{testimonial.title}</h4>
                  </div>
                  <p class="text-gray-600 text-sm italic leading-relaxed mb-4 flex-1">
                    {testimonial.quote}
                  </p>
                  <div class="flex items-center justify-between">
                    <span class="text-sm font-semibold text-[#FAC140]">— {testimonial.author}</span>
                    <div class="flex gap-0.5">
                      {[...Array(5)].map(() => (
                        <svg class="w-4 h-4 text-amber-400" fill="currentColor" viewBox="0 0 20 20">
                          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
                        </svg>
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
      
      {/* Mobile scroll indicator */}
      <div class="flex justify-center gap-1 mt-4 sm:hidden">
        <span class="text-xs text-gray-400">Glissez pour voir plus →</span>
      </div>
    </div>
    
  </div>
</section>